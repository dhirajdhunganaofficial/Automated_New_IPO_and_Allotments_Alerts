{% include 'commonHeadPart.html' %}

<body>

{% include 'header.html' %}

<section class="subscribe-form" id="subscribe-form">
    <h1 class="heading">Primary Share <span>Listing Alert</span></h1>

    <img class="thumbnail" src="../static/img/ipo_alert.gif" alt="New IPO Alert - Nepse">


    <form method="post">

        <div class="wrapper">

            <div class="contents">
                <div class="email">
                    <input id="email" type="text" class="sendEmail"
                           pattern="^[a-zA-Z0-9_.%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                           placeholder="Your email" name="email" required>
                </div>
                <div>
                    <button type="button" id="subscribe" class="btn-1">Add Subscription</button>
                </div>
            </div>

            <div class="manage-subscription" id="manage-subscription">
                <div class="settings-container">

                    <div class="card-container">
                        <div class="card">
                            <h3 class="title">How often would you like updates?</h3>
                            <p class="subTitle">Choose how frequently we should notify you. You can change this
                                anytime.</p>

                            <label class="option recommended">
                                <input type="radio" id="once" name="frequency" value="once" checked>
                                <div class="content">
                                    <span class="title">Daily updates</span>
                                    <span class="badge">Recommended</span>
                                    <p class="subTitle">One helpful summary every morning</p>
                                </div>
                            </label>

                            <label class="option">
                                <input type="radio" id="twice" name="frequency" value="twice">
                                <div class="content">
                                    <span class="title">Twice a day</span>
                                    <p class="subTitle">Morning & evening updates</p>
                                </div>
                            </label>

                            <!--<label class="option">
                                <input type="radio" id="new" name="frequency" value="new">
                                <div class="content">
                                    <span class="title">Only when something new appears</span>
                                    <p class="subTitle">Instant alerts for new listings</p>
                                </div>
                            </label>-->

                            <label class="option">
                                <input type="radio" id="onlyOnce" name="frequency" value="now">
                                <div class="content">
                                    <span class="title">Just check now</span>
                                    <p class="subTitle">One-time check, no notifications</p>
                                </div>
                            </label>

                            <button type="button" id="addSubscriber" onclick="subscribeUser()"
                                    class="btn-2 button-width">Start
                                Free
                                Notifications
                            </button>

                            <p class="subTitle privacy">ðŸ”’ No spam. <a href="">Unsubscribe</a> anytime.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </form>


</section>

<script>
    const subscribeBtn = document.getElementById('subscribe');
    const contentDiv = document.getElementById('manage-subscription');

    subscribeBtn.addEventListener('click', function() {
        contentDiv.classList.toggle('manage-subscription');

        if(window.getComputedStyle(contentDiv).display === "block"){
            subscribeBtn.textContent = "Manage Subscription"
            subscribeBtn.className = "btn-2"
        }else{
            subscribeBtn.textContent = "Add Subscription"
            subscribeBtn.className = "btn-1"
        }

    });

    const frequencyRadios = document.querySelectorAll('input[name="frequency"]');
    const subscribe = document.getElementById('addSubscriber');

    frequencyRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {

                if (this.value === 'now'){
                    subscribe.textContent = "Check Now"
                    subscribe.className = "btn-1"
                    subscribe.formAction = "/automationReport"
                    subscribe.removeAttribute("onclick")
                    subscribe.type="submit"
                    subscribe.classList.add("button-width")
                } else {
                    subscribe.textContent = "Start Free Notifications"
                    subscribe.className = "btn-2"
                    subscribe.classList.add("button-width")
                    subscribe.removeAttribute("formAction")
                }
                console.log(this.value)
            }
        });
    });

    function subscribeUser() {
        const email = document.getElementById("email").value;
        const frequency = document.querySelector('input[name="frequency"]:checked').value;

        fetch("/subscribe", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, frequency, timezone })
        })
        .then(res => res.json())
        .then((data) => {
            console.log(data.status);
            if(data.status == 'subscribed'){
                alert("Subscribed successfully");
            } else if(data.status == 'updated'){
                alert("Updated subscription successfully");
            }

            return data
        });
    }

</script>

{% include 'footer.html' %}